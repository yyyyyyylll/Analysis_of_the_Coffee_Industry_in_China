<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>星巴克与瑞幸联名数据（2022-2025M1-11）</title>
    <!-- 引入 Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* 保持中文字体美观和一致性 */
        body {
            font-family: 'Inter', 'Noto Sans SC', sans-serif;
            background-color: #f7f7f7;
        }

        /* 柱状图基础样式 */
        .collaboration-bar {
            height: 30px;
            min-width: 40px; /* 确保最小可见宽度 */
            transition: width 0.3s ease-in-out, transform 0.3s ease-in-out; /* 增加 transform 过渡 */
            border-radius: 4px;
        }

        /* 星巴克 - 淡绿色 */
        .starbucks-color {
            background-color: #a7f3d0; /* Tailwind: bg-green-200 */
        }
        /* 瑞幸 - 淡蓝色 */
        .luckin-color {
            background-color: #93c5fd; /* Tailwind: bg-blue-300 */
        }

        /* 年份标签样式：黑框白底，字体小一点 */
        .year-label-box {
            border: 1px solid #000;
            background-color: #ffffff;
            color: #000000;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: 600;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        /* 垂直时间轴线 */
        .timeline-line {
            width: 2px;
            background-color: #4b5563; /* 灰色 */
        }

        /* 响应式调整 */
        @media (max-width: 768px) {
            .collaboration-bar {
                height: 16px;
            }
            .text-3xl {
                font-size: 1.5rem;
            }
        }
    </style>
</head>
<body class="p-4 sm:p-8">

    <div class="max-w-4xl mx-auto bg-white p-6 sm:p-10 rounded-xl shadow-2xl">
        <h1 class="text-3xl font-bold text-gray-800 mb-8 text-center border-b pb-4">
            星巴克与瑞幸联名及限定数据（2022-2025M1-11）
        </h1>
        <div class="flex justify-center mb-6 space-x-6 text-sm font-medium">
            <div class="flex items-center">
                <div class="w-4 h-4 rounded-full starbucks-color mr-2"></div>
                <span>星巴克 (Starbucks)</span>
            </div>
            <div class="flex items-center">
                <div class="w-4 h-4 rounded-full luckin-color mr-2"></div>
                <span>瑞幸 (Luckin)</span>
            </div>
        </div>

        <!-- 核心时间轴容器 -->
        <div id="timeline-chart" class="relative">
            <!-- 居中垂直线 -->
            <div class="timeline-line absolute left-1/2 -translate-x-1/2 h-full top-0 z-0"></div>
        </div>

        <div class="text-xs text-center text-gray-500 mt-6">数据来源: 星巴克&瑞幸微信公众号，2025年数据截至M11。</div>
    </div>

    <script>
        // 原始数据
        const rawData = [
            { brand: '星巴克', year: '2022', count: 6, label: '2022' },
            { brand: '瑞幸', year: '2022', count: 17, label: '2022' },
            { brand: '星巴克', year: '2023', count: 14, label: '2023' },
            { brand: '瑞幸', year: '2023', count: 46, label: '2023' },
            { brand: '星巴克', year: '2024', count: 18, label: '2024' },
            { brand: '瑞幸', year: '2024', count: 37, label: '2024' },
            { brand: '星巴克', year: '2025（M1-11）', count: 18, label: '2025', sublabel: 'M1-11' },
            { brand: '瑞幸', year: '2025（M1-11）', count: 47, label: '2025', sublabel: 'M1-11' },
        ];

        // 整理数据，按年份分组
        const groupedData = rawData.reduce((acc, curr) => {
            const yearKey = curr.year.split('（')[0]; // 使用年份作为键
            if (!acc[yearKey]) {
                acc[yearKey] = [];
            }
            acc[yearKey].push(curr);
            return acc;
        }, {});

        const years = Object.keys(groupedData).sort();
        const MAX_COUNT = Math.max(...rawData.map(d => d.count)); // 45
        // 放大比例：将最大宽度从 40% 增加到 45%
        const MAX_BAR_WIDTH_PERCENT = 45; 

        const chartContainer = document.getElementById('timeline-chart');

        /**
         * 创建一个条形图元素
         * @param {string} brandName - 品牌名称
         * @param {number} count - 联名次数
         * @param {number} maxCount - 最大联名次数
         * @param {boolean} stretchLeft - 是否向左延伸
         * @returns {HTMLElement} Bar element container
         */
        function createBarElement(brandName, count, maxCount, stretchLeft) {
            const widthPercent = (count / maxCount) * MAX_BAR_WIDTH_PERCENT;
            const isStarbucks = brandName === '星巴克';
            const barClass = isStarbucks ? 'starbucks-color' : 'luckin-color';

            // 1. 实际柱子 (ActualBar)
            const actualBar = document.createElement('div');
            // 添加 hover 交互效果：scale-x-105
            actualBar.className = `collaboration-bar ${barClass} flex items-center h-6 relative shadow-md hover:z-30 hover:scale-x-[1.05] origin-center`; 
            actualBar.style.width = `${widthPercent}%`;
            actualBar.setAttribute('title', `${brandName}: ${count} 次`);
            
            // 2. 柱子上的次数文本 (CountText)
            const countText = document.createElement('span');
            countText.textContent = count;
            countText.className = `text-xs font-bold px-1 ${isStarbucks ? 'text-green-800' : 'text-blue-800'}`;

            // 3. 最终容器 (FinalBarContainer)
            const finalBarContainer = document.createElement('div');
            finalBarContainer.className = `flex items-center w-full my-1`; 
            
            if (stretchLeft) {
                // 向左延伸: 柱子靠右对齐 [Space | Bar]
                finalBarContainer.classList.add('flex-row-reverse'); 
                // 设置悬停放大时的原点为右侧（靠近中心轴）
                actualBar.classList.add('justify-end', 'origin-right'); 
                
            } else {
                // 向右延伸: 柱子靠左对齐 [Bar | Space]
                finalBarContainer.classList.add('flex-row'); 
                // 设置悬停放大时的原点为左侧（靠近中心轴）
                actualBar.classList.add('justify-start', 'origin-left'); 
            }
            
            // 组装：柱子添加到容器，文字添加到柱子
            finalBarContainer.appendChild(actualBar);
            actualBar.appendChild(countText);
            
            return finalBarContainer;
        }

        /**
         * 渲染年份块
         * @param {string} year - 年份字符串 (e.g., '2022')
         * @param {Array<Object>} data - 该年份的数据
         * @param {number} index - 年份索引
         */
        function renderYearBlock(year, data, index) {
            const yearData = data.find(d => d.year.startsWith(year));
            const yearLabel = yearData.label;
            const yearSublabel = yearData.sublabel;

            // 每年交替方向：2022(0) -> Left, 2023(1) -> Right, 2024(2) -> Left, 2025(3) -> Right
            const stretchDirection = index % 2 === 0 ? 'left' : 'right';
            const stretchLeft = stretchDirection === 'left';
            
            // 决定柱状图在 w-1/2 容器内的对齐方式
            const contentAlignmentClass = stretchLeft ? 'items-end' : 'items-start'; 

            const yearRow = document.createElement('div');
            // 缩小年份间距：mb-12 -> mb-8
            yearRow.className = `flex w-full relative z-10 items-center mb-8 flex-row`; 

            // --- 1. 左侧容器 (Left Half) ---
            const leftHalf = document.createElement('div');
            // pr-10, items-end/items-start
            leftHalf.className = `w-1/2 p-2 flex flex-col ${contentAlignmentClass} pr-10`; 
            
            // --- 2. 右侧容器 (Right Half) ---
            const rightHalf = document.createElement('div');
            // pl-10, items-end/items-start
            rightHalf.className = `w-1/2 p-2 flex flex-col ${contentAlignmentClass} pl-10`; 
            
            // --- 3. 填充逻辑 ---
            const starbucksData = data.find(d => d.brand === '星巴克');
            const luckinData = data.find(d => d.brand === '瑞幸');
            
            // 根据延伸方向，将两个品牌的柱状图都放入相应的容器
            if (stretchLeft) {
                // 2022, 2024: Both bars go into the LEFT half
                if (starbucksData) {
                    leftHalf.appendChild(createBarElement('星巴克', starbucksData.count, MAX_COUNT, stretchLeft));
                }
                if (luckinData) {
                    leftHalf.appendChild(createBarElement('瑞幸', luckinData.count, MAX_COUNT, stretchLeft));
                }
            } else {
                // 2023, 2025: Both bars go into the RIGHT half
                if (starbucksData) {
                    rightHalf.appendChild(createBarElement('星巴克', starbucksData.count, MAX_COUNT, stretchLeft));
                }
                if (luckinData) {
                    rightHalf.appendChild(createBarElement('瑞幸', luckinData.count, MAX_COUNT, stretchLeft));
                }
            }
            
            // --- 4. 时间轴上的年份标签 ---
            const timelineElement = document.createElement('div');
            timelineElement.className = 'absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 flex flex-col items-center';

            // 年份标签
            const labelBox = document.createElement('div');
            labelBox.className = 'year-label-box text-center text-sm z-20 mt-0'; 
            
            const labelSpan = document.createElement('span');
            labelSpan.textContent = yearLabel;
            labelBox.appendChild(labelSpan);

            if (yearSublabel) {
                const sublabelSpan = document.createElement('div');
                sublabelSpan.textContent = `(${yearSublabel})`;
                sublabelSpan.className = 'text-xs mt-0.5 font-normal';
                labelBox.appendChild(sublabelSpan);
            }
            
            timelineElement.appendChild(labelBox);

            // 5. 组装行内容
            yearRow.appendChild(leftHalf);
            yearRow.appendChild(rightHalf);
            yearRow.appendChild(timelineElement);

            chartContainer.appendChild(yearRow);
        }

        // 遍历渲染每个年份
        window.onload = function() {
            years.forEach((year, index) => {
                renderYearBlock(year, groupedData[year], index);
            });
        };
    </script>
</body>
</html>