<!--
	此示例下载自 https://echarts.apache.org/examples/zh/editor.html?c=bar-stack-normalization-and-variation&code=jVfdbhNHFL6PlHcYCaH1X5y1kxjHIa0ggHrRVkhc0MryxcS7sTdd71q7Y4gbIQUQFNqQVG1UAioNRaU_QkpKlYr8kndpvevkKq_QMzM7s7uOA72JZ2e-Oec7c875ZjI8jPJqfmQI_owif3XNe7Pp3fvGW1vytu54D-57W3eP9x50n7yFsb-x4j2_7y0_99deH-89HByo2pZLkINvXsIEo0lUHhxAqKxmR1S1mEHwmyuMVTIIXHS2Fro7B9yqBI3nGGhkTOUg_4c_--ByhSIzliuOjwfGdhZ7QWoxr1KQOl4YER4fngCNnhtnoEJ-pIIioOWvO7svO1tB1IMDlYnBgcEBWD9c_7m7_tjfWAZe3vamv7Drfbco4iY2waaInG6ZsR2UMHWCDJhRJ-DnvDicslrJmrpVI_UJlE4bSTRPOVGs22owNP2WBma5gdnQQGT3bJJtSk9K47OVskEJoJBTttly6wnAJWH-Fg2Hk645hgbGA_czpIRyqpqhX45Rq8NnkX8RuynH0zYhdqOECiqYYkcT2rpuaKQOBhvtqTp2SLamEzaVSKIhBgDiM0SMmQ-wEO7_SKdTcQN8LrQAXMSQU5EWqpjoNdtpCxYho-E-Jy92TWNHbIgbSEFxFKKwq1jTDKsGwEQcOSSNJMFVntdLKoX-Wb2Hjr561L2z3TlY91e2j_eednZWur894qXV2T_orvx-9GrVW9yhzbXz69GLHw8f_gUt5j9-7m996y2vQmehVGpYhmibUBVBbyln8pfPXRrJKyeailp487q7e8AakyJzY4WxKZUjezoLwIffP5PIy1cKU2qAjPYWtfnHEwkrXMhdHL8gXIfdRfVh85WETRXyxXxROb2_KH7nBcPzRuOBurpj6O6nuKG7MtwoaYXVotITSjAbpS2mIhTjU3E6Sj8awCDCJ9vAzUTCgmEGuYaWRJMf8A5ydNJyLD5GiAH4kLSbegkpUCTcNUIuwdUvYIp1qJgURQTzBfWsmDWI3rhG2iZYmOf5L_GfMjivoFsBzMTTugkQ_gUe6vbNEiJOS5BggtLAhOhgINHEDm64lLtYRYjPZW9gs6WjyUlktUwTfYgUBcGGTzCpZx27ZWnB3gCXopKh0rrPwd80Us7CEVJrgpjeaNaxa7iU_oxdbcFA4aepSIwGrVmSPUrj4oesZZDGT1iwlJJWhoUKOg_KCBRVYKgBhfgq35OkP1SoblHx40J-8JO_9NL75enh221vH4rvQefgmb94u7u7BtUEHfjvwu3O_tLRwrK_ugRteby32Nl65K9uyJ4U9aGbekO3CKvRmOhTzc7FNDsu-iDbLFXcDFXFzwLF4hKZPiFGs1xmAhFi-h7cuFQf6W5uJR2VqhRTI3630OXPhROqoumI5koUs0ZhDM5OLHIVRe4ynsM-95jg1bSNyMmE89TwRexIrU-IAzIqZRpkrhLLJJ9KQig9bKFgmQd-uZVZ9BlOu0JT_U4EGI3xYDuiLNk5nEqzh-L_oMezlBHnO9TjoD_j-Kb3RxWJIoiS51G6CQwIEvBoiLGQu0Vdcx9SVAIha9pmu2ZbQqGo2GC6MC9yLvqaCh1XrlBlZgwTdIormFGRQITsJq4apF1irzsxDY8V9sNDhy_2erGbxLAt8XKZBi2tMWma4vKoEAdbLsgUhEBJsieMQSJEiD4HrxtFvnX7PnX9u_e8-3-LKPn7SKmCTV3qOHsY5fjDiFvtlWrlDMgjXJMztkWuGV_CUq7Av66zI6f3gm1qoIUsQMHWtk1igG3BF_JUo8Kt4DnDFd7p-Co9cboyL7IDydDsm6G4Mp2-EtH-G-zKiir6jdNkXPAx9ZpuaSEdGvboWEy9IzdkdCftimA4dwH4hjY4WyFzIiZurMxSA8dGf0cVUSbvCTjqt93PGTsK4Yle0DAn_5uBa-AsSLtYbhgWlKL4wHOQuAiLjw2LZTm8ZuV5u03TIMH6O25jExCyWAJ-GnbruqiF8AplDoP7PXaL80yeTGSQwfiJ8ATJtOBm3ahKiqLhRZdN_Ac&enc=deflate
	⚠ 请注意，该图表不是 Apache ECharts 官方示例，而是由用户代码生成的。请注意鉴别其内容。
-->
<!DOCTYPE html>
<html lang="en" style="height: 100%">
<head>
  <meta charset="utf-8">
</head>
<body style="height: 100%; margin: 0">
  <div id="container" style="height: 100%"></div>

  
  <script type="text/javascript" src="https://fastly.jsdelivr.net/npm/echarts@5/dist/echarts.min.js"></script>
  
  <!-- Uncomment this line if you want to dataTool extension
  <script type="text/javascript" src="https://fastly.jsdelivr.net/npm/echarts@5/dist/extension/dataTool.min.js"></script>
  -->
  <!-- Uncomment this line if you want to use gl extension
  <script type="text/javascript" src="https://echarts.apache.org/zh/js/vendors/echarts-gl/dist/echarts-gl.min.js"></script>
  -->
  <!-- Uncomment this line if you want to echarts-stat extension
  <script type="text/javascript" src="https://echarts.apache.org/zh/js/vendors/echarts-stat/dist/ecStat.min.js"></script>
  -->
  <!-- Uncomment this line if you want to echarts-graph-modularity extension
  <script type="text/javascript" src="https://echarts.apache.org/zh/js/vendors/echarts-graph-modularity/dist/echarts-graph-modularity.min.js"></script>
  -->
  <!-- Uncomment this line if you want to use map
  <script type="text/javascript" src="https://fastly.jsdelivr.net/npm/echarts@4.9.0/map/js/world.js"></script>
  -->
  <!-- Uncomment these two lines if you want to use bmap extension
  <script type="text/javascript" src="https://api.map.baidu.com/api?v=3.0&ak=YOUR_API_KEY"></script>
  <script type="text/javascript" src="https://fastly.jsdelivr.net/npm/echarts@5/dist/extension/bmap.min.js"></script>
  -->

  <script type="text/javascript">
    var dom = document.getElementById('container');
    var myChart = echarts.init(dom, null, {
      renderer: 'canvas',
      useDirtyRect: false
    });
    var app = {};
    
    var option;

    // 2023-2024 星巴克城市分布（百分比堆叠柱）
const rawData = [
  [0.3008, 0.3165], // 一线城市
  [0.3091, 0.3350], // 新一线城市
  [0.1688, 0.1899], // 二线城市
  [0.0820, 0.0963], // 三线城市
  [0.0479, 0.0623]  // 三线及以下城市
];

// 计算每一年总和
const totalData = [];
for (let i = 0; i < rawData[0].length; ++i) {
  let sum = 0;
  for (let j = 0; j < rawData.length; ++j) sum += rawData[j][i];
  totalData.push(sum);
}

const grid = {
  left: 100,
  right: 80,
  top: 80,
  bottom: 60
};

const gridWidth = myChart.getWidth() - grid.left - grid.right;
const gridHeight = myChart.getHeight() - grid.top - grid.bottom;
const categoryWidth = gridWidth / rawData[0].length;
const barWidth = categoryWidth * 0.6;
const barPadding = (categoryWidth - barWidth) / 2;

/** ★ 重点修改：五种城市使用高区分度颜色（无渐变） **/
const color = [
  '#2E7D32', // 一线城市（深绿）
  '#1565C0', // 新一线城市（蓝）
  '#EF6C00', // 二线城市（橙）
  '#6A1B9A', // 三线城市（紫）
  '#C62828'  // 三线及以下城市（红）
];

const seriesNames = [
  '一线城市',
  '新一线城市',
  '二线城市',
  '三线城市',
  '三线及以下城市'
];

const series = seriesNames.map((name, sid) => {
  return {
    name,
    type: 'bar',
    stack: 'total',
    barWidth: '60%',
    itemStyle: { color: color[sid] },
    label: {
      show: true,
      formatter: (params) =>
        params.value == null ? '' : (Math.round(params.value * 1000) / 10) + '%'
    },
    emphasis: { focus: 'series' },
    data: rawData[sid].map((d, did) =>
      totalData[did] <= 0 ? 0 : d / totalData[did]
    )
  };
});

// 连接多边形（保持统一色、低透明度，不是渐变）
const elements = [];
for (let j = 1; j < rawData[0].length; ++j) {
  const leftX = grid.left + categoryWidth * j - barPadding;
  const rightX = leftX + barPadding * 2;
  let leftY = grid.top + gridHeight;
  let rightY = leftY;

  for (let i = 0; i < series.length; ++i) {
    const points = [];
    const leftBarHeight = (rawData[i][j - 1] / totalData[j - 1]) * gridHeight;
    points.push([leftX, leftY]);
    points.push([leftX, leftY - leftBarHeight]);

    const rightBarHeight = (rawData[i][j] / totalData[j]) * gridHeight;
    points.push([rightX, rightY - rightBarHeight]);
    points.push([rightX, rightY]);
    points.push([leftX, leftY]);

    leftY -= leftBarHeight;
    rightY -= rightBarHeight;

    elements.push({
      type: 'polygon',
      shape: { points },
      style: {
        fill: color[i],
        opacity: 0.18
      }
    });
  }
}

option = {
  backgroundColor: 'transparent',

  title: {
    text: '2023-2024星巴克城市分布情况',
    left: 'center',
    top: 10,
    textStyle: { color: '#000', fontSize: 16, fontWeight: 'bold' }
  },

  tooltip: {
    trigger: 'axis',
    axisPointer: { type: 'shadow' },
    valueFormatter: (v) => (Math.round(v * 1000) / 10) + '%'
  },

  legend: {
    top: 45,
    data: seriesNames
  },

  grid,

  xAxis: {
    type: 'category',
    data: ['2023', '2024'],
    axisPointer: { type: 'shadow' }
  },

  yAxis: {
    type: 'value',
    name: '百分比（%）',
    min: 0,
    max: 1,
    axisLine: { show: true },
    splitLine: {
      show: true,
      lineStyle: { type: 'dashed' }
    },
    axisLabel: { formatter: (v) => Math.round(v * 100) + '%' }
  },

  series,

  graphic: {
    elements
  }
};


    if (option && typeof option === 'object') {
      myChart.setOption(option);
    }

    window.addEventListener('resize', myChart.resize);
  </script>
</body>
</html>