<!--
	此示例下载自 https://echarts.apache.org/examples/zh/editor.html?c=bar-stack-normalization-and-variation&code=jVfdbhNHFL6PlHcYCUVrY8esDTHBIa0ggHrRVkhc0Mryxca7sTdd71q7Y4gbIaUgaFKiBGhaQgsJIEGpqPipQjFOQt6l9a6Tq7xCz5nZ2R8nAW68s7PfnPnOOXO-Mz5yhOTk3NFB-DlGurdX3Hctd3XBbV11Z2-4rWu7G7Pde-9h7L1cch_ecBcfequvdzfm-vtg4faj-d2N3zi8297qtv_Y3fjdnb2Lk-_WOuub_X1ly3QosZXLZxSqkFFS7O8jpChnssNpAr_5UpqAoU5rBtZzQz4gdxwBuSEO8H59tR_mBGKOyr6R9nwvIJtnuwyLXeb2AGQGyJZIBLD4U2f9Sad1UyBLI_193N8Xj7ov7novF4ELOOjNrLt3IAKz3aVnnfYCycryAHE378BXFiHuO7WoYgjv0dSEZZOEoVGiw4w8Ao-TIkBFuZQxNLNCqyMkldKTZBp5ItZp1Bga3wMDk9zAZGggsnoyyRalRgPjk6WijgRIyClTbzjVBOCSMH_Fd7O7edt7uOEuXvV-eQXedVoL3vKq-3bNvX6zOzfr3f8LHNz-cS3iY8XWVeDis52gBYxFGt9svVKF12H-Rq16MB63KLVqBZKXYWcW4dDWRV2lVTBYa45VFZtmKhplU4kkGWQA8HOCijHbAyyE67_QcCpugM-FFoCLGHIqgYWyQrWKZTcFi5DRkX0SJVaNK7ZYEDdwGE5YPgo7r6iqblYAmIgjBwMjSdgqJ47dv8vXyc7zZXe-jTXZfvrfzA87D1a81i13cXnn8f3tub97suTemscT-gQKcb7zfgvOpvvyHRRwJGNly4BT5NejdCh39viZozlpTzGCYe_t6-76FluKyOxQfmhM5sieqgTw9s8PAuTZc_kx2UdGaxNt_nkvgOVPZU-fOCW2DisU62rteQAby-eGc8PSwXWK-PZjhucFyx11NFvXnK-VmuYE7kZJS-wwSj2u-LNR2mIqQjE-FacjRXSju7Tqzd4K5NPnFGcI5CJUMzWlnkiYMEwTR1eTZPQzXl22Rhu2yceEMAAf0mZdKxAJDhBnRYhDlfJ3MMWKXUyKAwbzeXlAzOpUq12gTQMsTPOjUeCPImxeIld8mKGMawZA-BvsULUuFwi1G4IE06aaQqkGBhJ1xVZqDnIXXwnhc5lLitHQyOgoMRuGQT4nkkRgwVcKrWZsq2Gq_lofdxjlRMaayMJvikgDEF20JohptXpVcXQH6U9Y5QYMJB5NKcCoULaFoH7RLx5kNU1UHmHBMlDHInwokZMgskBRBoYqUIh_5WuS-EARu4I6ynJet4xmxTLJ9taKt_AEDmdQsliUmws7M4ve8gJUc6QoNUOraSZlBzXWKVDoszGhj3cK0HqWFG4GtfEbX7e4UKb2SNIkFxtfilhT8Fs1qiSu5lZSUcE6zDSJNyT8_K3YBLU0FVHeAMWsIYzBWWwi_SvSAHm29ml-glfd0iORCefR8GnFDhQ_IQKkl4roJLT2aM74VBJc6WELR5PtwDtikXmf5rRLmNQPIsBojAdbEWXJ4nAgzR6Kn0CPZykt4jvYs8H-jOOLPu5VxAvfS57HYBvfgCABN40Yi2C1ONd8j0A-fMnyK0VoEcqKgh-mRc5FBaOkcY0K9WRCN0CRuFbppQBIiFVXyjptFtj9T0zDDYc9uOvwxq48Vp3qUKn-_WUcVLPCRGiMC6FEbcV0QJDABSTJLjI6jRCh2hTccaTgHr33Gu1du-7eeCNc5FckqQwGtUCu2d0I7qOhyV5Flg6BCkKjnLBMekH_Hj7h_RbfLrJ4o_xbhgqSx7wTVC3LoDrYFmQhSRXUZ0mZ0h2xO47PY7jxy7RIDWRCtS6HGsrk-FxE4i-xzhQV7ksHqbXgY2gVzVRDOuj2saGYSEcaYXQlloQ_nDoFfEMbnK3QOOETN1ZkeYGw4fOYJM7IRxyO7tvcbzMWCrET9mGYC_4pgdwPgK6LzzXdhHMoXpQpSFyExZe6ybIcdlPYGa857tun3fab7c0198UKXDD8rl43dOov-UAfNgARnB-fsqo4VQ2PBxrfefTPzrVn7saMt_Q-3kwZJ7_Tx_o5T_beXPtJjgeN5zDInFKv6uWAshAEUYUj_wM&enc=deflate
	⚠ 请注意，该图表不是 Apache ECharts 官方示例，而是由用户代码生成的。请注意鉴别其内容。
-->
<!DOCTYPE html>
<html lang="en" style="height: 100%">
<head>
  <meta charset="utf-8">
</head>
<body style="height: 100%; margin: 0">
  <div id="container" style="height: 100%"></div>

  
  <script type="text/javascript" src="https://fastly.jsdelivr.net/npm/echarts@5/dist/echarts.min.js"></script>
  
  <!-- Uncomment this line if you want to dataTool extension
  <script type="text/javascript" src="https://fastly.jsdelivr.net/npm/echarts@5/dist/extension/dataTool.min.js"></script>
  -->
  <!-- Uncomment this line if you want to use gl extension
  <script type="text/javascript" src="https://echarts.apache.org/zh/js/vendors/echarts-gl/dist/echarts-gl.min.js"></script>
  -->
  <!-- Uncomment this line if you want to echarts-stat extension
  <script type="text/javascript" src="https://echarts.apache.org/zh/js/vendors/echarts-stat/dist/ecStat.min.js"></script>
  -->
  <!-- Uncomment this line if you want to echarts-graph-modularity extension
  <script type="text/javascript" src="https://echarts.apache.org/zh/js/vendors/echarts-graph-modularity/dist/echarts-graph-modularity.min.js"></script>
  -->
  <!-- Uncomment this line if you want to use map
  <script type="text/javascript" src="https://fastly.jsdelivr.net/npm/echarts@4.9.0/map/js/world.js"></script>
  -->
  <!-- Uncomment these two lines if you want to use bmap extension
  <script type="text/javascript" src="https://api.map.baidu.com/api?v=3.0&ak=YOUR_API_KEY"></script>
  <script type="text/javascript" src="https://fastly.jsdelivr.net/npm/echarts@5/dist/extension/bmap.min.js"></script>
  -->

  <script type="text/javascript">
    var dom = document.getElementById('container');
    var myChart = echarts.init(dom, null, {
      renderer: 'canvas',
      useDirtyRect: false
    });
    var app = {};
    
    var option;

    // 2023-2024 瑞幸城市分布（百分比堆叠柱）
// 行：城市线级；列：年份
const rawData = [
  [0.18, 0.16], // 一线城市
  [0.27, 0.25], // 新一线城市
  [0.29, 0.30], // 二线城市
  [0.16, 0.18], // 三线城市
  [0.10, 0.11]  // 三线及以下城市
];

// 计算每一年总和（用于 100% 归一）
const totalData = [];
for (let i = 0; i < rawData[0].length; ++i) {
  let sum = 0;
  for (let j = 0; j < rawData.length; ++j) sum += rawData[j][i];
  totalData.push(sum);
}

// 网格参数（与星巴克版本一致）
const grid = {
  left: 100,
  right: 80,
  top: 80,
  bottom: 60
};

const gridWidth = myChart.getWidth() - grid.left - grid.right;
const gridHeight = myChart.getHeight() - grid.top - grid.bottom;
const categoryWidth = gridWidth / rawData[0].length;
const barWidth = categoryWidth * 0.6;
const barPadding = (categoryWidth - barWidth) / 2;

// ★ 高区分度、非渐变颜色（与星巴克同一套，便于对比）
const color = [
  '#2E7D32', // 一线城市（深绿）
  '#1565C0', // 新一线城市（蓝）
  '#EF6C00', // 二线城市（橙）
  '#6A1B9A', // 三线城市（紫）
  '#C62828'  // 三线及以下城市（红）
];

const seriesNames = [
  '一线城市',
  '新一线城市',
  '二线城市',
  '三线城市',
  '三线及以下城市'
];

// 生成堆叠柱 series
const series = seriesNames.map((name, sid) => {
  return {
    name,
    type: 'bar',
    stack: 'total',
    barWidth: '60%',
    itemStyle: { color: color[sid] },
    label: {
      show: true,
      formatter: (params) =>
        params.value == null ? '' : (Math.round(params.value * 1000) / 10) + '%'
    },
    emphasis: { focus: 'series' },
    data: rawData[sid].map((d, did) =>
      totalData[did] <= 0 ? 0 : d / totalData[did]
    )
  };
});

// polygon 连接（非渐变，低透明度）
const elements = [];
for (let j = 1; j < rawData[0].length; ++j) {
  const leftX = grid.left + categoryWidth * j - barPadding;
  const rightX = leftX + barPadding * 2;
  let leftY = grid.top + gridHeight;
  let rightY = leftY;

  for (let i = 0; i < series.length; ++i) {
    const points = [];
    const leftBarHeight = (rawData[i][j - 1] / totalData[j - 1]) * gridHeight;
    points.push([leftX, leftY]);
    points.push([leftX, leftY - leftBarHeight]);

    const rightBarHeight = (rawData[i][j] / totalData[j]) * gridHeight;
    points.push([rightX, rightY - rightBarHeight]);
    points.push([rightX, rightY]);
    points.push([leftX, leftY]);

    leftY -= leftBarHeight;
    rightY -= rightBarHeight;

    elements.push({
      type: 'polygon',
      shape: { points },
      style: {
        fill: color[i],
        opacity: 0.18
      }
    });
  }
}

option = {
  backgroundColor: 'transparent',

  title: {
    text: '2023-2024瑞幸城市分布情况',
    left: 'center',
    top: 10,
    textStyle: { color: '#000', fontSize: 16, fontWeight: 'bold' }
  },

  tooltip: {
    trigger: 'axis',
    axisPointer: { type: 'shadow' },
    valueFormatter: (v) => (Math.round(v * 1000) / 10) + '%'
  },

  legend: {
    top: 45,
    data: seriesNames
  },

  grid,

  xAxis: {
    type: 'category',
    data: ['2023', '2024'],
    axisPointer: { type: 'shadow' }
  },

  yAxis: {
    type: 'value',
    name: '百分比（%）',
    min: 0,
    max: 1,
    axisLine: { show: true }, // 左纵轴实线
    splitLine: {
      show: true,
      lineStyle: { type: 'dashed' } // 顶部开放
    },
    axisLabel: { formatter: (v) => Math.round(v * 100) + '%' }
  },

  series,

  graphic: {
    elements
  }
};


    if (option && typeof option === 'object') {
      myChart.setOption(option);
    }

    window.addEventListener('resize', myChart.resize);
  </script>
</body>
</html>